---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: monovertexrollouts.numaplane.numaproj.io
spec:
  group: numaplane.numaproj.io
  names:
    kind: MonoVertexRollout
    listKind: MonoVertexRolloutList
    plural: monovertexrollouts
    singular: monovertexrollout
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - description: The current phase
      jsonPath: .status.phase
      name: Phase
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: MonoVertexRollout is the Schema for the monovertexrollouts API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: MonoVertexRolloutSpec defines the desired state of MonoVertexRollout
            properties:
              monoVertex:
                description: MonoVertex includes the spec of MonoVertex in Numaflow
                properties:
                  metadata:
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        type: object
                      labels:
                        additionalProperties:
                          type: string
                        type: object
                    type: object
                  spec:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                required:
                - spec
                type: object
              strategy:
                description: PipelineTypeRolloutStrategy specifies the RolloutStrategy
                  for fields shared by Pipeline and MonoVertex
                properties:
                  progressive:
                    properties:
                      assessmentSchedule:
                        description: |-
                          optional string: comma-separated list consisting of:
                          assessmentDelay, assessmentPeriod, assessmentInterval
                        type: string
                      forcePromote:
                        description: if ForcePromote is set, assessment will be skipped
                          and Progressive upgrade will succeed
                        type: boolean
                    type: object
                type: object
            required:
            - monoVertex
            type: object
          status:
            description: MonoVertexRolloutStatus defines the observed state of MonoVertexRollout
            properties:
              conditions:
                description: Conditions are the latest available observations of a
                  resource's current state.
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource.\n---\nThis struct is intended for
                    direct use as an array at the field path .status.conditions.  For
                    example,\n\n\n\ttype FooStatus struct{\n\t    // Represents the
                    observations of a foo's current state.\n\t    // Known .status.conditions.type
                    are: \"Available\", \"Progressing\", and \"Degraded\"\n\t    //
                    +patchMergeKey=type\n\t    // +patchStrategy=merge\n\t    // +listType=map\n\t
                    \   // +listMapKey=type\n\t    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`\n\n\n\t
                    \   // other fields\n\t}"
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: |-
                        type of condition in CamelCase or in foo.example.com/CamelCase.
                        ---
                        Many .condition.type values are consistent across resources like Available, but because arbitrary conditions can be
                        useful (see .node.status.conditions), the ability to deconflict is important.
                        The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastFailureTime:
                description: LastFailureTime records the timestamp of the Last Failure
                  (PhaseFailed)
                format: date-time
                type: string
              message:
                description: Message is added if Phase is PhaseFailed.
                type: string
              nameCount:
                description: |-
                  NameCount is used as a suffix for the name of the managed monovertex, to uniquely
                  identify a monovertex.
                format: int32
                type: integer
              observedGeneration:
                description: ObservedGeneration stores the generation value observed
                  when setting the current Phase
                format: int64
                type: integer
              phase:
                description: Phase indicates the current phase of the resource.
                enum:
                - ""
                - Pending
                - Deployed
                - Failed
                type: string
              progressiveStatus:
                description: ProgressiveStatus stores fields related to the Progressive
                  strategy
                properties:
                  promotedMonoVertexStatus:
                    description: PromotedMonoVertexStatus stores information regarding
                      the current "promoted" MonoVertex
                    properties:
                      allSourceVerticesScaledDown:
                        description: AllSourceVerticesScaledDown indicates if ALL
                          the promoted child source vertices have been scaled down
                        type: boolean
                      name:
                        description: Name of the promoted child
                        type: string
                      scaleValues:
                        additionalProperties:
                          description: ScaleValues stores the original scale min and
                            max values, scaleTo value, and actual scale value of a
                            pipeline or monovertex vertex
                          properties:
                            actual:
                              description: Actual indicates how many pods are actually
                                running for the vertex
                              format: int64
                              type: integer
                            originalScaleMinMax:
                              description: OriginalScaleMinMax stores the original
                                scale min and max values as JSON string
                              type: string
                            scaleTo:
                              description: ScaleTo indicates how many pods to scale
                                down to
                              format: int64
                              type: integer
                          required:
                          - actual
                          - scaleTo
                          type: object
                        description: |-
                          ScaleValues is a map where the keys are the promoted child source vertices names
                          and the values are the scale values of the source vertices
                        type: object
                      scaleValuesRestoredToOriginal:
                        description: |-
                          ScaleValuesRestoredToOriginal indicates if ALL the promoted child source vertices have been set back to the original min and max scale values.
                          This field being set to `true` invalidates the value(s) in the scaleValues.Actual field.
                        type: boolean
                    required:
                    - name
                    type: object
                  upgradingMonoVertexStatus:
                    description: UpgradingMonoVertexStatus represents either the current
                      or otherwise the most recent "upgrading" MonoVertex
                    properties:
                      assessmentEndTime:
                        description: AssessmentEndTime indicates the time after which
                          no more assessments will be performed
                        format: date-time
                        type: string
                      assessmentResult:
                        description: AssessmentResult described whether it's failed
                          or succeeded, or to be determined
                        type: string
                      assessmentStartTime:
                        description: AssessmentStartTime indicates the time at/after
                          which the assessment result will be computed
                        format: date-time
                        type: string
                      forcedSuccess:
                        description: ForcedSuccess indicates if this promotion was
                          forced to complete
                        type: boolean
                      name:
                        description: Name of the upgrading child
                        type: string
                    required:
                    - name
                    type: object
                type: object
              upgradeInProgress:
                description: UpgradeInProgress indicates the upgrade strategy currently
                  being used and affecting the resource state or empty if no upgrade
                  is in progress
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
